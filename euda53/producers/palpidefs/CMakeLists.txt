set(name "PALPIDEFSProducer.exe")
set(sourcefiles src/PALPIDEFSProducer.cxx)
# config files to be installed

if (NOT CMAKE_PALPIDEFS_DRIVER_INCLUDE)
  message(FATAL_ERROR "Path to pALPIDEfs driver not set - you need to set CMAKE_PALPIDEFS_DRIVER_INCLUDE")
endif(NOT CMAKE_PALPIDEFS_DRIVER_INCLUDE)

FIND_PACKAGE( TINYXML REQUIRED )
if (TINYXML_FOUND)
  INCLUDE_DIRECTORIES( ${TINYXML_INCLUDE_DIRS} )
  SET(ADDITIONAL_LIBRARIES ${TINYXML_LIBRARIES} )
  ADD_DEFINITIONS(-DUSE_TINYXML)
endif (TINYXML_FOUND)

find_package(libusb-1.0 REQUIRED)

if (NOT EXISTS "${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/TTestsetup.h")
  message(FATAL_ERROR "Path to pALPIDEfs driver is wrong - Could not find ${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/TTestsetup.h")
endif (NOT EXISTS "${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/TTestsetup.h")
if (NOT EXISTS "${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/libpalpidefs.so")
  message(FATAL_ERROR "Path to pALPIDEfs driver is wrong - Could not find ${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/libpalpidefs.so")
endif (NOT EXISTS "${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/libpalpidefs.so")

set(driver_library "${CMAKE_PALPIDEFS_DRIVER_INCLUDE}/libpalpidefs.so" )

INCLUDE_DIRECTORIES( "include" ${CMAKE_PALPIDEFS_DRIVER_INCLUDE} ${LIBUSB_1_INCLUDE_DIRS})
ADD_EXECUTABLE(${name} ${sourcefiles})

TARGET_LINK_LIBRARIES(${name} EUDAQ ${CMAKE_THREAD_LIBS_INIT} ${LIBUSB_1_LIBRARIES} ${TINYXML_LIBRARIES} ${driver_library})

SET_TARGET_PROPERTIES(EUDAQ PROPERTIES COMPILE_DEFINITIONS "PALPIDEFS")

INSTALL(TARGETS ${name}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)


INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs.conf DESTINATION ${CMAKE_INSTALL_PREFIX}/conf)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs.init DESTINATION ${CMAKE_INSTALL_PREFIX}/conf)
INSTALL(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs DESTINATION ${CMAKE_INSTALL_PREFIX}/conf)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs/full_pALPIDE-1.xml DESTINATION ${CMAKE_INSTALL_PREFIX}/conf/palpidefs)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs/full_pALPIDE-2.xml DESTINATION ${CMAKE_INSTALL_PREFIX}/conf/palpidefs)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs/full_pALPIDE-3.xml DESTINATION ${CMAKE_INSTALL_PREFIX}/conf/palpidefs)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/conf/palpidefs/full_pALPIDE-4.xml DESTINATION ${CMAKE_INSTALL_PREFIX}/conf/palpidefs)
